<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shorts Match - ãƒã‚¤ãƒšãƒ¼ã‚¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 60%, #e0e7ff 100%); }
        .gradient-btn { background: linear-gradient(135deg, #06b6d4, #3b82f6); }
        .gradient-text { background: linear-gradient(135deg, #06b6d4, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card { background: white; border-radius: 24px; box-shadow: 0 4px 24px rgba(0,0,0,0.07); }
        .fade-in { animation: fadeIn 0.5s ease both; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(16px); } to { opacity:1; transform:translateY(0); } }
        .slide-down { animation: slideDown 0.3s ease both; }
        @keyframes slideDown { from { opacity:0; transform:translateY(-6px); } to { opacity:1; transform:translateY(0); } }
        .tool-chip input[type=checkbox] { display:none; }
        .tool-chip input:checked + label {
            background: linear-gradient(135deg, #06b6d4, #3b82f6);
            color: white; border-color: transparent;
            box-shadow: 0 2px 8px rgba(6,182,212,0.4);
        }
        .tool-chip label {
            display: inline-block; padding: 6px 14px; border-radius: 20px;
            border: 2px solid #e2e8f0; background: #f8fafc;
            color: #475569; font-size: 13px; font-weight: 700;
            cursor: pointer; transition: all 0.2s; user-select: none;
        }
        .tool-chip label:hover { border-color: #06b6d4; color: #06b6d4; }
        .genre-chip input[type=checkbox] { display:none; }
        .genre-chip input:checked + label {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            color: white; border-color: transparent;
        }
        .genre-chip label {
            display: inline-block; padding: 6px 14px; border-radius: 20px;
            border: 2px solid #e2e8f0; background: #f8fafc;
            color: #475569; font-size: 13px; font-weight: 700;
            cursor: pointer; transition: all 0.2s; user-select: none;
        }
        .tab-active { background: white; color: #1e293b; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .tab-inactive { color: #94a3b8; }
        .avatar-ring {
            border: 4px solid white;
            box-shadow: 0 0 0 3px #06b6d4, 0 8px 24px rgba(6,182,212,0.3);
        }
        .preview-card {
            background: white; border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            overflow: hidden; transition: transform 0.3s;
        }
        .preview-card:hover { transform: translateY(-4px); }
        .thumb-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .thumb-item {
            position: relative; border-radius: 10px; overflow: hidden; aspect-ratio: 9/16;
            transform: translateY(0); transition: transform 0.25s ease, box-shadow 0.25s ease;
            cursor: pointer;
        }
        .thumb-item:hover { transform: translateY(-6px); box-shadow: 0 12px 32px rgba(6,182,212,0.25); }
        .thumb-item img { width:100%; height:100%; object-fit:cover; transition: opacity 0.2s; }
        .thumb-item:hover img.thumb-static { opacity: 0; }
        .thumb-item video.thumb-video {
            position: absolute; inset: 0; width: 100%; height: 100%;
            object-fit: cover; opacity: 0; transition: opacity 0.3s;
            pointer-events: none;
        }
        .thumb-item:hover video.thumb-video { opacity: 1; }
        .thumb-play {
            position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.2s;
        }
        .thumb-item:hover .thumb-play { opacity: 1; }

        /* ===== ãƒãƒ£ãƒƒãƒˆUI ===== */
        .chat-bubble-wrap { display: flex; flex-direction: column; gap: 10px; }
        .chat-row { display: flex; align-items: flex-end; gap: 8px; }
        .chat-row.me { flex-direction: row-reverse; }
        .chat-avatar-sm { width: 30px; height: 30px; border-radius: 10px; object-fit: cover; flex-shrink: 0; }
        .chat-bubble {
            max-width: 72%; padding: 10px 14px; border-radius: 18px;
            font-size: 14px; line-height: 1.55; word-break: break-word;
        }
        .chat-bubble.them {
            background: #f1f5f9; color: #1e293b;
            border-bottom-left-radius: 4px;
        }
        .chat-bubble.me {
            background: linear-gradient(135deg, #06b6d4, #3b82f6);
            color: white; border-bottom-right-radius: 4px;
        }
        .chat-time { font-size: 10px; color: #94a3b8; margin-top: 2px; text-align: right; }
        .chat-time.them { text-align: left; }
        .chat-date-divider {
            text-align: center; font-size: 11px; font-weight: 700;
            color: #94a3b8; padding: 8px 0;
        }
        .chat-input-area {
            border-top: 2px solid #f1f5f9;
            padding: 12px 16px; display: flex; gap: 10px; align-items: flex-end;
            background: white;
        }
        .chat-input-area textarea {
            flex: 1; resize: none; border: 2px solid #e2e8f0; border-radius: 16px;
            padding: 10px 14px; font-size: 14px; outline: none; font-family: inherit;
            transition: border-color 0.2s; max-height: 120px; line-height: 1.5;
        }
        .chat-input-area textarea:focus { border-color: #06b6d4; }
        .chat-send-btn {
            width: 42px; height: 42px; border-radius: 14px; border: none; flex-shrink: 0;
            background: linear-gradient(135deg, #06b6d4, #3b82f6);
            color: white; font-size: 18px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: opacity 0.2s, transform 0.15s;
        }
        .chat-send-btn:hover { opacity: 0.88; transform: scale(1.07); }
        .chat-messages { flex: 1; overflow-y: auto; padding: 16px; min-height: 200px; max-height: 420px; }
        .section-tab { cursor: pointer; padding: 10px 20px; border-radius: 12px; font-weight: 700; font-size: 14px; transition: all 0.2s; }
        .section-tab.active { background: linear-gradient(135deg, #06b6d4, #3b82f6); color: white; }
        .section-tab:not(.active) { color: #64748b; }
        .section-tab:not(.active):hover { background: #f1f5f9; }
        input[type=text], input[type=url], input[type=email], input[type=password] {
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus, textarea:focus {
            box-shadow: 0 0 0 3px rgba(6,182,212,0.15);
        }
        @media (min-width: 768px) {
            .mypage-layout { display: grid; grid-template-columns: 300px 1fr; gap: 24px; align-items: start; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-slate-100">
    <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
        <a href="index.html" class="flex items-center gap-2 group">
            <div class="w-8 h-8 gradient-btn rounded-lg flex items-center justify-center text-white text-sm font-black shadow group-hover:scale-110 transition-transform">â–¶</div>
            <span class="font-black text-xl text-cyan-600">Shorts Match</span>
        </a>
        <div class="flex items-center gap-3">
            <span id="headerEmail" class="text-xs text-slate-400 hidden md:block"></span>
            <a href="index.html" class="text-sm font-bold text-slate-500 hover:text-cyan-600 transition-colors px-3 py-1.5 rounded-lg hover:bg-cyan-50">â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
        </div>
    </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-8">

    <!-- ===== ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ² ===== -->
    <div id="authSection" class="max-w-md mx-auto fade-in">
        <div class="text-center mb-8">
            <div class="w-16 h-16 gradient-btn rounded-2xl flex items-center justify-center text-white text-2xl mx-auto mb-4 shadow-lg shadow-cyan-200">âœï¸</div>
            <h1 class="text-3xl font-black text-slate-800 mb-2">ç·¨é›†è€…ãƒãƒ¼ã‚¿ãƒ«</h1>
            <p class="text-slate-500">ãƒ­ã‚°ã‚¤ãƒ³ã¾ãŸã¯æ–°è¦ç™»éŒ²ã‚’ã—ã¦ãã ã•ã„</p>
        </div>
        <div class="card p-8">
            <div class="flex rounded-2xl bg-slate-100 p-1 mb-8">
                <button id="tabLogin" onclick="switchTab('login')" class="flex-1 py-2.5 rounded-xl font-bold text-sm transition-all tab-active">ãƒ­ã‚°ã‚¤ãƒ³</button>
                <button id="tabRegister" onclick="switchTab('register')" class="flex-1 py-2.5 rounded-xl font-bold text-sm transition-all tab-inactive">æ–°è¦ç™»éŒ²</button>
            </div>
            <!-- ãƒ­ã‚°ã‚¤ãƒ³ -->
            <div id="loginForm" class="space-y-4">
                <input id="loginEmail" type="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50">
                <input id="loginPassword" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50">
                <div id="loginMsg" class="hidden text-sm font-bold px-4 py-3 rounded-xl"></div>
                <button onclick="handleLogin()" class="w-full gradient-btn text-white py-4 rounded-2xl font-bold shadow-lg shadow-cyan-200 hover:scale-[1.02] hover:opacity-90 transition-all">ãƒ­ã‚°ã‚¤ãƒ³</button>
            </div>
            <!-- æ–°è¦ç™»éŒ² -->
            <div id="registerForm" class="hidden space-y-4">
                <div>
                    <input id="regName" type="text" placeholder="ãŠåå‰ï¼ˆè¡¨ç¤ºåï¼‰"
                        class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50">
                    <p class="text-xs text-slate-400 mt-1.5 px-1">âœ¦ ç·¨é›†è€…ä¸€è¦§ã‚«ãƒ¼ãƒ‰ã«è¡¨ç¤ºã•ã‚Œã‚‹åå‰ã§ã™</p>
                </div>
                <input id="regEmail" type="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50">
                <input id="regPassword" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ6æ–‡å­—ä»¥ä¸Šï¼‰"
                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50">
                <div id="registerMsg" class="hidden text-sm font-bold px-4 py-3 rounded-xl"></div>
                <button onclick="handleRegister()" class="w-full gradient-btn text-white py-4 rounded-2xl font-bold shadow-lg shadow-cyan-200 hover:scale-[1.02] hover:opacity-90 transition-all">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ</button>
            </div>
        </div>
    </div>

    <!-- ===== ãƒã‚¤ãƒšãƒ¼ã‚¸ ===== -->
    <div id="mypageSection" class="hidden fade-in">
        <div class="mypage-layout">

            <!-- å·¦ã‚«ãƒ©ãƒ ï¼šãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ï¼‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <div class="space-y-5">

                <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ -->
                <div class="card p-6 text-center">
                    <!-- ã‚¢ãƒã‚¿ãƒ¼ -->
                    <div class="relative inline-block mb-4">
                        <img id="avatarImg" src="" alt="avatar"
                            class="w-24 h-24 rounded-2xl avatar-ring object-cover mx-auto">
                        <div class="absolute -bottom-1 -right-1 w-7 h-7 gradient-btn rounded-full flex items-center justify-center text-white text-xs shadow cursor-pointer"
                            onclick="document.getElementById('imageUrlInput').focus()">âœï¸</div>
                    </div>
                    <h2 class="text-xl font-black text-slate-800 mt-3" id="mypageName">èª­ã¿è¾¼ã¿ä¸­...</h2>
                    <p class="text-cyan-500 font-bold text-sm mt-1" id="mypageEmail"></p>
                    <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒƒã‚¸ -->
                    <div id="profileToolBadges" class="flex flex-wrap gap-1.5 justify-center mt-3"></div>
                    <!-- å˜ä¾¡ -->
                    <div id="profilePrice" class="mt-3 text-2xl font-black gradient-text"></div>
                    <button onclick="handleLogout()"
                        class="mt-4 w-full text-slate-400 text-sm py-2.5 rounded-xl border-2 border-slate-100 hover:text-red-500 hover:border-red-100 transition-all font-bold">
                        ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </button>
                </div>

                <!-- å®Ÿç¸¾ãƒ»è©•ä¾¡ã‚«ãƒ¼ãƒ‰ -->
                <div class="card p-5">
                    <h3 class="font-black text-slate-700 text-sm mb-4 flex items-center gap-2">
                        ğŸ“Š å®Ÿç¸¾ãƒ»è©•ä¾¡
                    </h3>
                    <div class="grid grid-cols-2 gap-3">
                        <!-- æ¡ˆä»¶æ•° -->
                        <div class="bg-cyan-50 rounded-2xl p-4 text-center">
                            <div class="text-3xl font-black gradient-text" id="statsProjects">-</div>
                            <div class="text-xs font-bold text-slate-400 mt-1">å—æ³¨æ¡ˆä»¶æ•°</div>
                        </div>
                        <!-- è©•ä¾¡ -->
                        <div class="bg-amber-50 rounded-2xl p-4 text-center">
                            <div class="text-3xl font-black text-amber-500" id="statsRating">-</div>
                            <div class="text-xs font-bold text-slate-400 mt-1">å¹³å‡è©•ä¾¡ â­</div>
                        </div>
                    </div>
                    <p class="text-xs text-slate-400 text-center mt-3">å®Ÿç¸¾ãƒ»è©•ä¾¡ã¯ç®¡ç†è€…ãŒæ›´æ–°ã—ã¾ã™</p>
                </div>

                <!-- å…¬é–‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                <div class="card p-5">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-base font-black text-slate-700">ğŸ‘ å…¬é–‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
                        <span class="text-xs bg-cyan-100 text-cyan-600 font-bold px-2 py-0.5 rounded-full">ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰è¦‹ãŸå§¿</span>
                    </div>
                    <div class="preview-card">
                        <div class="h-1.5 bg-gradient-to-r from-cyan-400 to-blue-500"></div>
                        <div class="p-4">
                            <div class="flex items-center gap-3 mb-3">
                                <img id="previewAvatar" src="" class="w-12 h-12 rounded-xl object-cover border-2 border-cyan-100">
                                <div>
                                    <div class="font-black text-slate-800 text-sm" id="previewName">æœªè¨­å®š</div>
                                    <div class="text-xs text-cyan-500 font-bold" id="previewGenres">å¾—æ„ã‚¸ãƒ£ãƒ³ãƒ«æœªè¨­å®š</div>
                                </div>
                            </div>
                            <div id="previewTools" class="flex flex-wrap gap-1 mb-3"></div>
                            <div class="flex justify-between items-center pt-2 border-t border-slate-50">
                                <div class="text-xs text-slate-400">å˜ä¾¡ç›®å®‰</div>
                                <div class="font-black text-cyan-600 text-sm" id="previewPrice">æœªè¨­å®š</div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- å³ã‚«ãƒ©ãƒ ï¼šã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <div class="space-y-5">

                <!-- ã‚¿ãƒ–ãƒŠãƒ“ -->
                <div class="card p-2 flex gap-1 flex-wrap">
                    <button class="section-tab active" onclick="switchSection('profile', this)">ğŸ“ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</button>
                    <button class="section-tab" onclick="switchSection('portfolio', this)">ğŸ¬ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª</button>
                    <button class="section-tab" onclick="switchSection('chat', this)">ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ</button>
                </div>

                <!-- ===== ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›† ===== -->
                <div id="sectionProfile" class="card p-7 space-y-6">

                    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ -->
                    <div>
                        <label class="block text-xs font-black text-slate-400 uppercase tracking-wider mb-3">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ</label>

                        <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
                        <div id="uploadArea"
                            class="relative border-2 border-dashed border-slate-200 rounded-2xl p-6 text-center cursor-pointer hover:border-cyan-400 hover:bg-cyan-50/30 transition-all group"
                            onclick="document.getElementById('avatarFileInput').click()"
                            ondragover="event.preventDefault(); this.classList.add('border-cyan-400','bg-cyan-50/30')"
                            ondragleave="this.classList.remove('border-cyan-400','bg-cyan-50/30')"
                            ondrop="handleDrop(event)">
                            <!-- ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ï¼ˆéè¡¨ç¤ºï¼‰ -->
                            <input type="file" id="avatarFileInput" accept="image/*" class="hidden" onchange="handleFileSelect(event)">
                            <div id="uploadPlaceholder">
                                <div class="w-12 h-12 bg-slate-100 rounded-2xl flex items-center justify-center mx-auto mb-3 group-hover:bg-cyan-100 transition-colors">
                                    <span class="text-2xl">ğŸ“·</span>
                                </div>
                                <p class="font-bold text-slate-600 text-sm">ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</p>
                                <p class="text-xs text-slate-400 mt-1">JPG / PNG / GIF / WebPï¼ˆæœ€å¤§5MBï¼‰</p>
                            </div>
                            <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­è¡¨ç¤º -->
                            <div id="uploadProgress" class="hidden">
                                <div class="w-12 h-12 mx-auto mb-3 flex items-center justify-center">
                                    <svg class="animate-spin w-8 h-8 text-cyan-500" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                                    </svg>
                                </div>
                                <p class="font-bold text-cyan-600 text-sm">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...</p>
                            </div>
                        </div>

                        <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                        <div id="uploadMsg" class="hidden text-xs font-bold px-3 py-2 rounded-xl mt-2 slide-down"></div>

                        <!-- URLç›´æ¥å…¥åŠ› or è‡ªå‹•ç”Ÿæˆ -->
                        <div class="flex gap-2 mt-3">
                            <input id="imageUrlInput" type="url" placeholder="ç”»åƒURLã‚’ç›´æ¥å…¥åŠ›"
                                class="flex-1 px-3 py-2.5 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50 text-xs"
                                oninput="previewAvatar(this.value)">
                            <button onclick="randomAvatar()"
                                class="px-3 py-2.5 bg-gradient-to-r from-violet-500 to-pink-500 text-white rounded-xl font-bold text-xs whitespace-nowrap hover:opacity-90 transition-all shadow shadow-violet-200">
                                ğŸ² è‡ªå‹•ç”Ÿæˆ
                            </button>
                        </div>
                        <p class="text-xs text-slate-400 mt-1.5 px-1">ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¾ãŸã¯URLã‚’å…¥åŠ›ã€‚ã€Œè‡ªå‹•ç”Ÿæˆã€ã§DiceBearã‚¢ãƒã‚¿ãƒ¼ã‚’ä½œæˆ</p>
                    </div>

                    <!-- è¡¨ç¤ºå -->
                    <div>
                        <label class="block text-xs font-black text-slate-400 uppercase tracking-wider mb-2">è¡¨ç¤ºå <span class="text-red-400">*</span></label>
                        <input id="mpName" type="text" placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ"
                            class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50">
                    </div>

                    <!-- å˜ä¾¡ -->
                    <div>
                        <label class="block text-xs font-black text-slate-400 uppercase tracking-wider mb-2">å˜ä¾¡ç›®å®‰</label>
                        <input id="mpPrice" type="text" placeholder="ä¾‹ï¼šÂ¥3,000ã€œ"
                            class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50">
                    </div>

                    <!-- ä½¿ç”¨å¯èƒ½ã‚½ãƒ•ãƒˆ -->
                    <div>
                        <label class="block text-xs font-black text-slate-400 uppercase tracking-wider mb-3">ä½¿ç”¨å¯èƒ½ã‚½ãƒ•ãƒˆ</label>
                        <div class="flex flex-wrap gap-2" id="toolsChips">
                            <span class="tool-chip"><input type="checkbox" id="sw1" value="Premiere Pro"><label for="sw1">ğŸ¬ Premiere Pro</label></span>
                            <span class="tool-chip"><input type="checkbox" id="sw2" value="After Effects"><label for="sw2">âœ¨ After Effects</label></span>
                            <span class="tool-chip"><input type="checkbox" id="sw3" value="Final Cut Pro"><label for="sw3">ğŸ¥ Final Cut Pro</label></span>
                            <span class="tool-chip"><input type="checkbox" id="sw4" value="DaVinci Resolve"><label for="sw4">ğŸï¸ DaVinci Resolve</label></span>
                            <span class="tool-chip"><input type="checkbox" id="sw5" value="Photoshop"><label for="sw5">ğŸ¨ Photoshop</label></span>
                            <span class="tool-chip"><input type="checkbox" id="sw6" value="Cinema 4D"><label for="sw6">ğŸ­ Cinema 4D</label></span>
                            <span class="tool-chip"><input type="checkbox" id="sw7" value="CapCut"><label for="sw7">ğŸ“± CapCut</label></span>
                        </div>
                    </div>

                    <!-- å¾—æ„ã‚¸ãƒ£ãƒ³ãƒ« -->
                    <div>
                        <label class="block text-xs font-black text-slate-400 uppercase tracking-wider mb-3">å¾—æ„ã‚¸ãƒ£ãƒ³ãƒ«</label>
                        <div class="flex flex-wrap gap-2" id="genreChips">
                            <span class="genre-chip"><input type="checkbox" id="g1" value="Shortsã‚²ãƒ¼ãƒ å®Ÿæ³"><label for="g1">ğŸ® ã‚²ãƒ¼ãƒ å®Ÿæ³</label></span>
                            <span class="genre-chip"><input type="checkbox" id="g2" value="VTuber"><label for="g2">ğŸŒŸ VTuber</label></span>
                            <span class="genre-chip"><input type="checkbox" id="g3" value="æ–™ç†ãƒ»ã‚°ãƒ«ãƒ¡"><label for="g3">ğŸœ æ–™ç†ãƒ»ã‚°ãƒ«ãƒ¡</label></span>
                            <span class="genre-chip"><input type="checkbox" id="g4" value="æ—…è¡Œãƒ»Vlog"><label for="g4">âœˆï¸ æ—…è¡Œãƒ»Vlog</label></span>
                            <span class="genre-chip"><input type="checkbox" id="g5" value="æ•™è‚²ãƒ»ãƒã‚¦ãƒ„ãƒ¼"><label for="g5">ğŸ“š æ•™è‚²ãƒ»ãƒã‚¦ãƒ„ãƒ¼</label></span>
                            <span class="genre-chip"><input type="checkbox" id="g6" value="éŸ³æ¥½ãƒ»ãƒ€ãƒ³ã‚¹"><label for="g6">ğŸµ éŸ³æ¥½ãƒ»ãƒ€ãƒ³ã‚¹</label></span>
                            <span class="genre-chip"><input type="checkbox" id="g7" value="ã‚¹ãƒãƒ¼ãƒ„"><label for="g7">âš½ ã‚¹ãƒãƒ¼ãƒ„</label></span>
                            <span class="genre-chip"><input type="checkbox" id="g8" value="åˆ‡ã‚ŠæŠœã"><label for="g8">âœ‚ï¸ åˆ‡ã‚ŠæŠœã</label></span>
                        </div>
                    </div>

                    <!-- SNSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ -->
                    <div>
                        <label class="block text-xs font-black text-slate-400 uppercase tracking-wider mb-3">SNSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</label>
                        <div class="space-y-2.5">
                            <div class="flex items-center gap-3">
                                <span class="w-8 text-center text-lg flex-shrink-0">â–¶ï¸</span>
                                <input id="snYoutube" type="url" placeholder="YouTube ãƒãƒ£ãƒ³ãƒãƒ«URL"
                                    class="flex-1 px-4 py-2.5 border-2 border-slate-200 rounded-xl outline-none focus:border-red-400 bg-slate-50 text-sm">
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="w-8 text-center text-lg flex-shrink-0">ğŸµ</span>
                                <input id="snTiktok" type="url" placeholder="TikTok ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«URL"
                                    class="flex-1 px-4 py-2.5 border-2 border-slate-200 rounded-xl outline-none focus:border-slate-400 bg-slate-50 text-sm">
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="w-8 text-center text-lg flex-shrink-0">ğŸ“¸</span>
                                <input id="snInstagram" type="url" placeholder="Instagram ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«URL"
                                    class="flex-1 px-4 py-2.5 border-2 border-slate-200 rounded-xl outline-none focus:border-pink-400 bg-slate-50 text-sm">
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="w-8 text-center text-lg flex-shrink-0">ğŸ¦</span>
                                <input id="snX" type="url" placeholder="X (Twitter) ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«URL"
                                    class="flex-1 px-4 py-2.5 border-2 border-slate-200 rounded-xl outline-none focus:border-slate-600 bg-slate-50 text-sm">
                            </div>
                        </div>
                    </div>

                    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
                    <div id="mypageStatus" class="hidden text-sm font-bold px-4 py-3 rounded-xl text-center slide-down"></div>

                    <button onclick="handleUpdate()"
                        class="w-full gradient-btn text-white py-4 rounded-2xl font-black text-base shadow-lg shadow-cyan-200 hover:scale-[1.02] hover:opacity-90 transition-all">
                        ğŸ’¾ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä¿å­˜ã™ã‚‹
                    </button>
                </div>

                <!-- ===== ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª ===== -->
                <div id="sectionPortfolio" class="hidden space-y-5">

                    <!-- å‹•ç”»URLè¿½åŠ  -->
                    <div class="card p-7">
                        <h3 class="font-black text-slate-700 mb-1">ğŸ¬ å‹•ç”»ã‚’è¿½åŠ </h3>
                        <p class="text-xs text-slate-400 mb-4">YouTubeãƒ»YouTube Shortsãƒ»TikTokã®URLã«å¯¾å¿œã—ã¦ã„ã¾ã™</p>

                        <!-- å¯¾å¿œãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒãƒƒã‚¸ -->
                        <div class="flex gap-2 mb-4">
                            <span class="flex items-center gap-1.5 text-xs font-bold px-3 py-1.5 rounded-full bg-red-50 text-red-500 border border-red-100">
                                <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor"><path d="M23.5 6.19a3.02 3.02 0 00-2.12-2.14C19.54 3.5 12 3.5 12 3.5s-7.54 0-9.38.55A3.02 3.02 0 00.5 6.19C0 8.04 0 12 0 12s0 3.96.5 5.81a3.02 3.02 0 002.12 2.14C4.46 20.5 12 20.5 12 20.5s7.54 0 9.38-.55a3.02 3.02 0 002.12-2.14C24 15.96 24 12 24 12s0-3.96-.5-5.81zM9.75 15.02V8.98L15.5 12l-5.75 3.02z"/></svg>
                                YouTube
                            </span>
                            <span class="flex items-center gap-1.5 text-xs font-bold px-3 py-1.5 rounded-full bg-red-50 text-red-500 border border-red-100">
                                <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor"><path d="M23.5 6.19a3.02 3.02 0 00-2.12-2.14C19.54 3.5 12 3.5 12 3.5s-7.54 0-9.38.55A3.02 3.02 0 00.5 6.19C0 8.04 0 12 0 12s0 3.96.5 5.81a3.02 3.02 0 002.12 2.14C4.46 20.5 12 20.5 12 20.5s7.54 0 9.38-.55a3.02 3.02 0 002.12-2.14C24 15.96 24 12 24 12s0-3.96-.5-5.81zM9.75 15.02V8.98L15.5 12l-5.75 3.02z"/></svg>
                                YouTube Shorts
                            </span>
                            <span class="flex items-center gap-1.5 text-xs font-bold px-3 py-1.5 rounded-full bg-slate-800 text-white border border-slate-700">
                                <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-2.88 2.5 2.89 2.89 0 01-2.89-2.89 2.89 2.89 0 012.89-2.89c.28 0 .54.04.79.1V9.01a6.33 6.33 0 00-.79-.05 6.34 6.34 0 00-6.34 6.34 6.34 6.34 0 006.34 6.34 6.34 6.34 0 006.33-6.34V8.69a8.18 8.18 0 004.78 1.52V6.75a4.85 4.85 0 01-1.01-.06z"/></svg>
                                TikTok
                            </span>
                        </div>

                        <div class="flex gap-3">
                            <input id="ytUrlInput" type="url" placeholder="å‹•ç”»ã®URLã‚’è²¼ã‚Šä»˜ã‘..."
                                class="flex-1 px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50 text-sm">
                            <button onclick="addVideo()"
                                class="px-5 py-3 gradient-btn text-white rounded-xl font-bold text-sm hover:opacity-90 transition-all shadow-lg shadow-cyan-200 whitespace-nowrap">
                                è¿½åŠ 
                            </button>
                        </div>
                        <div id="addVideoMsg" class="hidden text-xs font-bold px-3 py-2 rounded-xl mt-2"></div>
                    </div>

                    <!-- ã‚µãƒ ãƒã‚¤ãƒ«ã‚®ãƒ£ãƒ©ãƒªãƒ¼ -->
                    <div class="card p-7">
                        <div class="flex items-center justify-between mb-5">
                            <h3 class="font-black text-slate-700">ğŸ“¸ ä½œå“ã‚®ãƒ£ãƒ©ãƒªãƒ¼</h3>
                            <span class="text-xs text-slate-400 font-bold" id="videoCount">0 / 6</span>
                        </div>
                        <div id="thumbGallery" class="thumb-grid">
                            <div class="col-span-3 text-center py-12 text-slate-300">
                                <div class="text-4xl mb-2">ğŸ¬</div>
                                <p class="text-sm font-bold">å‹•ç”»URLã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>
                            </div>
                        </div>
                        <button onclick="saveVideos()"
                            id="saveVideoBtn"
                            class="hidden w-full mt-5 gradient-btn text-white py-3.5 rounded-2xl font-black text-sm shadow-lg shadow-cyan-200 hover:scale-[1.02] transition-all">
                            ğŸ’¾ ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚’ä¿å­˜ã™ã‚‹
                        </button>
                        <div id="videoStatus" class="hidden text-sm font-bold px-4 py-3 rounded-xl text-center slide-down mt-3"></div>
                    </div>

                </div>

                <!-- ===== ãƒãƒ£ãƒƒãƒˆ ===== -->
                <div id="sectionChat" class="hidden">
                    <div class="card overflow-hidden flex flex-col" style="height: 580px;">

                        <!-- ãƒãƒ£ãƒƒãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ -->
                        <div class="px-5 py-4 border-b border-slate-100 flex items-center justify-between bg-white">
                            <div class="flex items-center gap-3">
                                <div class="w-9 h-9 gradient-btn rounded-xl flex items-center justify-center text-white text-base">ğŸ’¬</div>
                                <div>
                                    <div class="font-black text-slate-800 text-sm">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div>
                                    <div class="text-xs text-slate-400" id="chatOnlineStatus">æ¥ç¶šä¸­...</div>
                                </div>
                            </div>
                            <!-- ç›¸æ‰‹é¸æŠ -->
                            <select id="chatPartnerSelect"
                                onchange="selectChatPartner(this.value)"
                                class="text-xs font-bold border-2 border-slate-200 rounded-xl px-3 py-2 outline-none focus:border-cyan-400 bg-slate-50 max-w-[160px]">
                                <option value="">ç›¸æ‰‹ã‚’é¸æŠ...</option>
                            </select>
                        </div>

                        <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ -->
                        <div class="chat-messages" id="chatMessages">
                            <div class="text-center py-16 text-slate-300">
                                <div class="text-4xl mb-3">ğŸ’¬</div>
                                <p class="text-sm font-bold">ãƒãƒ£ãƒƒãƒˆç›¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                            </div>
                        </div>

                        <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
                        <div class="chat-input-area">
                            <textarea id="chatInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." rows="1"
                                onkeydown="if(event.key==='Enter' && !event.shiftKey){ event.preventDefault(); sendMessage(); }"
                                oninput="this.style.height='auto'; this.style.height=Math.min(this.scrollHeight,120)+'px'"></textarea>
                            <button class="chat-send-btn" onclick="sendMessage()">â¤</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

</main>

<script>
    // ===== Supabase =====
    const SUPABASE_URL = 'https://dwmgwdhunvanrsautvtj.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_GzaEGCWBP7y0za2UVPiJNA_N3pdlgJ0';
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let videoList = []; // å‹•ç”»URLä¸€è¦§

    // ===== èµ·å‹• =====
    window.addEventListener('load', async () => {
        const { data: { session } } = await sb.auth.getSession();
        if (session) {
            await loadMypage(session.user);
            // request.htmlã‹ã‚‰é·ç§»ã—ã¦ããŸå ´åˆã€ãƒãƒ£ãƒƒãƒˆã‚¿ãƒ–ã‚’è‡ªå‹•ã§é–‹ã
            const openChat = new URLSearchParams(location.search).get('open_chat');
            if (openChat) {
                // ãƒã‚¤ãƒšãƒ¼ã‚¸è¡¨ç¤ºå¾Œã«ãƒãƒ£ãƒƒãƒˆã‚¿ãƒ–ã¸åˆ‡ã‚Šæ›¿ãˆ
                setTimeout(() => {
                    const chatBtn = document.querySelector('.section-tab:nth-child(3)');
                    if (chatBtn) {
                        switchSection('chat', chatBtn);
                        setTimeout(() => {
                            const select = document.getElementById('chatPartnerSelect');
                            if (select) {
                                select.value = openChat;
                                selectChatPartner(openChat);
                            }
                        }, 800);
                    }
                }, 600);
            }
        } else {
            showAuth();
        }
    });

    // ===== ã‚¿ãƒ– =====
    function switchTab(tab) {
        const isLogin = tab === 'login';
        document.getElementById('loginForm').classList.toggle('hidden', !isLogin);
        document.getElementById('registerForm').classList.toggle('hidden', isLogin);
        document.getElementById('tabLogin').className  = `flex-1 py-2.5 rounded-xl font-bold text-sm transition-all ${isLogin  ? 'tab-active' : 'tab-inactive'}`;
        document.getElementById('tabRegister').className = `flex-1 py-2.5 rounded-xl font-bold text-sm transition-all ${!isLogin ? 'tab-active' : 'tab-inactive'}`;
    }

    // ===== ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ãƒ– =====
    function switchSection(section, btn) {
        document.querySelectorAll('.section-tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('sectionProfile').classList.toggle('hidden', section !== 'profile');
        document.getElementById('sectionPortfolio').classList.toggle('hidden', section !== 'portfolio');
        document.getElementById('sectionChat').classList.toggle('hidden', section !== 'chat');
        if (section === 'chat') initChat();
    }

    // ===== ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ =====
    function showMsg(elId, msg, type) {
        const el = document.getElementById(elId);
        const s = { error:'bg-red-50 text-red-600 border border-red-200', success:'bg-emerald-50 text-emerald-600 border border-emerald-200', info:'bg-cyan-50 text-cyan-600 border border-cyan-200' };
        el.className = `text-sm font-bold px-4 py-3 rounded-xl slide-down ${s[type]||s.info}`;
        el.textContent = msg;
        el.classList.remove('hidden');
    }
    function hideMsg(id) { document.getElementById(id).classList.add('hidden'); }

    // ===== ãƒ­ã‚°ã‚¤ãƒ³ =====
    async function handleLogin() {
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;
        hideMsg('loginMsg');
        if (!email || !password) { showMsg('loginMsg','âš ï¸ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„','error'); return; }
        showMsg('loginMsg','â³ ãƒ­ã‚°ã‚¤ãƒ³ä¸­...','info');
        const { data, error } = await sb.auth.signInWithPassword({ email, password });
        if (error) { showMsg('loginMsg','âŒ '+error.message,'error'); return; }
        showMsg('loginMsg','âœ… ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸï¼ãƒã‚¤ãƒšãƒ¼ã‚¸ã¸ç§»å‹•ã—ã¾ã™','success');
        setTimeout(() => loadMypage(data.user), 1000);
    }

    // ===== æ–°è¦ç™»éŒ² =====
    async function handleRegister() {
        const name = document.getElementById('regName').value.trim();
        const email = document.getElementById('regEmail').value.trim();
        const password = document.getElementById('regPassword').value;
        hideMsg('registerMsg');
        if (!name)               { showMsg('registerMsg','âš ï¸ ãŠåå‰ï¼ˆè¡¨ç¤ºåï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„','error'); return; }
        if (!email)              { showMsg('registerMsg','âš ï¸ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„','error'); return; }
        if (password.length < 6) { showMsg('registerMsg','âš ï¸ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã«ã—ã¦ãã ã•ã„','error'); return; }
        showMsg('registerMsg','â³ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆä¸­...','info');
        const { data, error } = await sb.auth.signUp({ email, password });
        if (error) { showMsg('registerMsg','âŒ '+error.message,'error'); return; }
        if (data.user) {
            const { error: dbErr } = await sb.from('editors').upsert({ id: data.user.id, name }, { onConflict: 'id' });
            if (dbErr) { console.error(dbErr); }
            showMsg('registerMsg','âœ… ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸï¼ãƒã‚¤ãƒšãƒ¼ã‚¸ã¸ç§»å‹•ã—ã¾ã™','success');
            setTimeout(() => loadMypage(data.user), 2000);
        } else {
            showMsg('registerMsg','ğŸ“© ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚','info');
        }
    }

    // ===== ãƒã‚¤ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ =====
    async function loadMypage(user) {
        showMypage();
        document.getElementById('mypageEmail').textContent = user.email;
        document.getElementById('headerEmail').textContent = user.email;

        const { data } = await sb.from('editors').select('*').filter('id::text','eq',user.id).maybeSingle();
        if (!data) { renderMypage({ name: 'æœªè¨­å®š' }, user); return; }

        // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’ã‚»ãƒƒãƒˆ
        document.getElementById('mpName').value        = data.name          || '';
        document.getElementById('mpPrice').value       = data.price         || '';
        document.getElementById('imageUrlInput').value = data.image_url     || '';

        // SNSãƒªãƒ³ã‚¯
        const sns = data.sns_links || {};
        document.getElementById('snYoutube').value   = sns.youtube   || '';
        document.getElementById('snTiktok').value    = sns.tiktok    || '';
        document.getElementById('snInstagram').value = sns.instagram || '';
        document.getElementById('snX').value         = sns.x         || '';

        // å®Ÿç¸¾ãƒ»è©•ä¾¡
        document.getElementById('statsProjects').textContent = data.projects != null ? data.projects + 'ä»¶' : '-';
        document.getElementById('statsRating').textContent   = data.rating   != null ? data.rating           : '-';

        // ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
        const tools = Array.isArray(data.tools) ? data.tools : [];
        document.querySelectorAll('#toolsChips input[type=checkbox]').forEach(cb => {
            cb.checked = tools.includes(cb.value);
        });

        // ã‚¸ãƒ£ãƒ³ãƒ«ãƒã‚§ãƒƒã‚¯
        const genres = Array.isArray(data.genres) ? data.genres : [];
        document.querySelectorAll('#genreChips input[type=checkbox]').forEach(cb => {
            cb.checked = genres.includes(cb.value);
        });

        // å‹•ç”»ãƒªã‚¹ãƒˆ
        videoList = Array.isArray(data.sample_videos) ? data.sample_videos : [];
        renderGallery();

        renderMypage(data, user);
    }

    // ===== UIåæ˜  =====
    function renderMypage(data, user) {
        const name   = data.name  || 'æœªè¨­å®š';
        const price  = data.price || '';
        const tools  = Array.isArray(data.tools)  ? data.tools  : [];
        const genres = Array.isArray(data.genres) ? data.genres : [];

        // ã‚¢ãƒã‚¿ãƒ¼
        const avatarUrl = data.image_url
            || `https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(name)}`;
        document.getElementById('avatarImg').src    = avatarUrl;
        document.getElementById('previewAvatar').src = avatarUrl;

        // åå‰ãƒ»ãƒ¡ãƒ¼ãƒ«
        document.getElementById('mypageName').textContent = name;
        document.getElementById('previewName').textContent = name;

        // å˜ä¾¡
        document.getElementById('profilePrice').textContent = price ? price : '';
        document.getElementById('previewPrice').textContent = price || 'æœªè¨­å®š';

        // ã‚¸ãƒ£ãƒ³ãƒ«
        document.getElementById('previewGenres').textContent =
            genres.length > 0 ? genres.slice(0,2).join(' / ') : 'å¾—æ„ã‚¸ãƒ£ãƒ³ãƒ«æœªè¨­å®š';

        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒã‚¸ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ï¼‰
        const badgeColors = {
            'Premiere Pro':'bg-violet-100 text-violet-700',
            'After Effects':'bg-blue-100 text-blue-700',
            'Final Cut Pro':'bg-indigo-100 text-indigo-700',
            'DaVinci Resolve':'bg-red-100 text-red-700',
            'Photoshop':'bg-sky-100 text-sky-700',
            'Cinema 4D':'bg-pink-100 text-pink-700',
            'CapCut':'bg-emerald-100 text-emerald-700',
        };
        document.getElementById('profileToolBadges').innerHTML = tools.map(t =>
            `<span class="text-xs font-bold px-2.5 py-1 rounded-full ${badgeColors[t]||'bg-slate-100 text-slate-600'}">${t}</span>`
        ).join('');

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒã‚¸
        const toolIcons = {'Premiere Pro':'ğŸ¬','After Effects':'âœ¨','Final Cut Pro':'ğŸ¥','DaVinci Resolve':'ğŸï¸','Photoshop':'ğŸ¨','Cinema 4D':'ğŸ­','CapCut':'ğŸ“±'};
        document.getElementById('previewTools').innerHTML = tools.slice(0,4).map(t =>
            `<span class="text-xs font-bold px-2 py-0.5 rounded-lg bg-slate-100 text-slate-600">${toolIcons[t]||'ğŸ’»'} ${t}</span>`
        ).join('');
    }

    // ===== ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ =====
    function handleDrop(e) {
        e.preventDefault();
        document.getElementById('uploadArea').classList.remove('border-cyan-400','bg-cyan-50/30');
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) uploadAvatarFile(file);
        else alert('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
    }

    function handleFileSelect(e) {
        const file = e.target.files[0];
        if (file) uploadAvatarFile(file);
    }

    async function uploadAvatarFile(file) {
        // 5MBä¸Šé™ãƒã‚§ãƒƒã‚¯
        if (file.size > 5 * 1024 * 1024) {
            showUploadMsg('âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯5MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„', 'error');
            return;
        }

        // â‘  ãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å³æ™‚åæ˜ 
        const localUrl = URL.createObjectURL(file);
        document.getElementById('avatarImg').src     = localUrl;
        document.getElementById('previewAvatar').src = localUrl;

        // â‘¡ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        document.getElementById('uploadPlaceholder').classList.add('hidden');
        document.getElementById('uploadProgress').classList.remove('hidden');
        hideMsg('uploadMsg');

        try {
            const { data: { user } } = await sb.auth.getUser();
            if (!user) throw new Error('ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã¦ã„ã¾ã™ã€‚å†ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„');

            // â‘¢ ãƒ•ã‚¡ã‚¤ãƒ«åï¼šuserId.æ‹¡å¼µå­ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãï¼‰
            const ext      = file.name.split('.').pop();
            const filePath = `${user.id}.${ext}`;

            const { error: upErr } = await sb.storage
                .from('avatars')
                .upload(filePath, file, { upsert: true, contentType: file.type });

            if (upErr) throw upErr;

            // â‘£ å…¬é–‹URLå–å¾—
            const { data: urlData } = sb.storage.from('avatars').getPublicUrl(filePath);
            const publicUrl = urlData.publicUrl;

            // â‘¤ editorsãƒ†ãƒ¼ãƒ–ãƒ«ã®image_urlã‚’è‡ªå‹•æ›´æ–°
            const { error: dbErr } = await sb.from('editors').upsert(
                { id: user.id, image_url: publicUrl },
                { onConflict: 'id' }
            );
            if (dbErr) throw dbErr;

            // â‘¥ URLå…¥åŠ›æ¬„ã«ã‚‚åæ˜ 
            document.getElementById('imageUrlInput').value = publicUrl;
            document.getElementById('avatarImg').src        = publicUrl;
            document.getElementById('previewAvatar').src    = publicUrl;

            showUploadMsg('âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ï¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');

        } catch (err) {
            console.error('upload error:', err);
            showUploadMsg('âŒ ' + err.message, 'error');
        } finally {
            document.getElementById('uploadPlaceholder').classList.remove('hidden');
            document.getElementById('uploadProgress').classList.add('hidden');
            // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆåŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†é¸æŠã§ãã‚‹ã‚ˆã†ã«ï¼‰
            document.getElementById('avatarFileInput').value = '';
        }
    }

    function showUploadMsg(msg, type) {
        const el = document.getElementById('uploadMsg');
        const s  = { error:'bg-red-50 text-red-600 border border-red-200', success:'bg-emerald-50 text-emerald-600 border border-emerald-200' };
        el.className = `text-xs font-bold px-3 py-2 rounded-xl mt-2 slide-down ${s[type]||'bg-cyan-50 text-cyan-600'}`;
        el.textContent = msg;
        el.classList.remove('hidden');
        if (type === 'success') setTimeout(() => el.classList.add('hidden'), 4000);
    }

    // ===== ã‚¢ãƒã‚¿ãƒ¼ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ =====
    function previewAvatar(url) {
        const src = url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${Math.random()}`;
        document.getElementById('avatarImg').src     = src;
        document.getElementById('previewAvatar').src = src;
    }

    function randomAvatar() {
        const styles = ['avataaars','bottts','fun-emoji','lorelei','micah','personas'];
        const style  = styles[Math.floor(Math.random() * styles.length)];
        const seed   = Math.random().toString(36).slice(2);
        const url    = `https://api.dicebear.com/7.x/${style}/svg?seed=${seed}`;
        document.getElementById('imageUrlInput').value = url;
        previewAvatar(url);
    }

    // ===== ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¿å­˜ =====
    async function handleUpdate() {
        hideMsg('mypageStatus');
        const name  = document.getElementById('mpName').value.trim();
        if (!name) { showMsg('mypageStatus','âš ï¸ è¡¨ç¤ºåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„','error'); return; }
        showMsg('mypageStatus','â³ ä¿å­˜ä¸­...','info');

        const { data: { user } } = await sb.auth.getUser();
        if (!user) { showMsg('mypageStatus','âŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã¦ã„ã¾ã™','error'); return; }

        const tools  = Array.from(document.querySelectorAll('#toolsChips input:checked')).map(c=>c.value);
        const genres = Array.from(document.querySelectorAll('#genreChips input:checked')).map(c=>c.value);
        const sns = {
            youtube:   document.getElementById('snYoutube').value.trim()   || null,
            tiktok:    document.getElementById('snTiktok').value.trim()    || null,
            instagram: document.getElementById('snInstagram').value.trim() || null,
            x:         document.getElementById('snX').value.trim()         || null,
        };

        const { error } = await sb.from('editors').upsert({
            id:        user.id,
            name,
            price:     document.getElementById('mpPrice').value.trim()       || null,
            image_url: document.getElementById('imageUrlInput').value.trim() || null,
            sns_links: sns,
            tools,
            genres,
        }, { onConflict: 'id' });

        if (error) { console.error(error); showMsg('mypageStatus','âŒ '+error.message,'error'); return; }

        // UIåæ˜ 
        const currentData = {
            name, price: document.getElementById('mpPrice').value.trim(),
            image_url: document.getElementById('imageUrlInput').value.trim(),
            tools, genres,
        };
        renderMypage(currentData, user);
        showMsg('mypageStatus','âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼','success');
        setTimeout(() => hideMsg('mypageStatus'), 3000);
    }

    // ===== YouTubeã‚µãƒ ãƒã‚¤ãƒ« =====
    // ===== å‹•ç”»URLè§£æï¼ˆYouTubeé€šå¸¸ãƒ»Shortsãƒ»TikTokå¯¾å¿œï¼‰=====
    function parseVideoUrl(url) {
        // YouTubeé€šå¸¸: watch?v=XXXX or youtu.be/XXXX
        const ytNormal = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
        if (ytNormal) return { type: 'youtube', id: ytNormal[1] };

        // YouTube Shorts: /shorts/XXXX
        const ytShorts = url.match(/youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/);
        if (ytShorts) return { type: 'youtube_shorts', id: ytShorts[1] };

        // TikTok: /@user/video/XXXX or /v/XXXX
        const tiktok = url.match(/tiktok\.com\/@[\w.-]+\/video\/(\d+)/);
        if (tiktok) return { type: 'tiktok', id: tiktok[1], url };

        // TikTokçŸ­ç¸®URL: vm.tiktok.com / vt.tiktok.com
        const tiktokShort = url.match(/(?:vm|vt)\.tiktok\.com\/([a-zA-Z0-9]+)/);
        if (tiktokShort) return { type: 'tiktok', id: tiktokShort[1], url };

        return null;
    }

    function addVideo() {
        const addMsg = document.getElementById('addVideoMsg');
        addMsg.classList.add('hidden');

        if (videoList.length >= 6) {
            addMsg.className = 'text-xs font-bold px-3 py-2 rounded-xl mt-2 bg-red-50 text-red-500 border border-red-100';
            addMsg.textContent = 'âš ï¸ å‹•ç”»ã¯æœ€å¤§6ä»¶ã¾ã§è¿½åŠ ã§ãã¾ã™';
            addMsg.classList.remove('hidden');
            return;
        }

        const url    = document.getElementById('ytUrlInput').value.trim();
        const parsed = parseVideoUrl(url);

        if (!parsed) {
            addMsg.className = 'text-xs font-bold px-3 py-2 rounded-xl mt-2 bg-red-50 text-red-500 border border-red-100';
            addMsg.textContent = 'âŒ å¯¾å¿œã—ã¦ã„ãªã„URLã§ã™ã€‚YouTubeãƒ»YouTube Shortsãƒ»TikTokã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
            addMsg.classList.remove('hidden');
            return;
        }

        const key = parsed.type + '_' + parsed.id;
        if (videoList.find(v => (v.type + '_' + v.id) === key)) {
            addMsg.className = 'text-xs font-bold px-3 py-2 rounded-xl mt-2 bg-amber-50 text-amber-600 border border-amber-100';
            addMsg.textContent = 'âš ï¸ ã“ã®å‹•ç”»ã¯ã™ã§ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™';
            addMsg.classList.remove('hidden');
            return;
        }

        videoList.push({ type: parsed.type, id: parsed.id, url });
        document.getElementById('ytUrlInput').value = '';
        renderGallery();
    }

    function removeVideo(index) {
        videoList.splice(index, 1);
        renderGallery();
    }

    function renderGallery() {
        const gallery  = document.getElementById('thumbGallery');
        const countEl  = document.getElementById('videoCount');
        const saveBtn  = document.getElementById('saveVideoBtn');
        countEl.textContent = `${videoList.length} / 6`;
        saveBtn.classList.toggle('hidden', videoList.length === 0);

        if (videoList.length === 0) {
            gallery.innerHTML = `
                <div class="col-span-3 text-center py-12 text-slate-300">
                    <div class="text-4xl mb-2">ğŸ¬</div>
                    <p class="text-sm font-bold">å‹•ç”»URLã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>
                </div>`;
            return;
        }

        gallery.innerHTML = videoList.map((v, i) => {
            const isYt  = v.type === 'youtube' || v.type === 'youtube_shorts' || !v.type;
            const badge = v.type === 'youtube_shorts' ? 'Shorts' : v.type === 'tiktok' ? 'TikTok' : 'YouTube';
            const badgeBg = v.type === 'tiktok' ? '#000' : '#ff0000';

            let thumbSrc, linkUrl, videoEmbed;
            if (isYt) {
                thumbSrc   = `https://img.youtube.com/vi/${v.id}/mqdefault.jpg`;
                linkUrl    = v.type === 'youtube_shorts' ? `https://youtube.com/shorts/${v.id}` : `https://youtube.com/watch?v=${v.id}`;
                // YouTube iframe embed for hover preview
                videoEmbed = `<iframe class="thumb-video"
                    src="https://www.youtube.com/embed/${v.id}?autoplay=1&mute=1&controls=0&loop=1&playlist=${v.id}&rel=0&modestbranding=1"
                    frameborder="0" allow="autoplay; encrypted-media" allowfullscreen
                    style="position:absolute;inset:0;width:100%;height:100%;opacity:0;transition:opacity 0.3s;pointer-events:none;border-radius:10px;"></iframe>`;
            } else {
                thumbSrc   = `https://api.dicebear.com/7.x/icons/svg?seed=tiktok${v.id}&backgroundColor=000000`;
                linkUrl    = v.url || '#';
                videoEmbed = ''; // TikTokã¯iframeåŸ‹ã‚è¾¼ã¿éå¯¾å¿œ
            }

            return `
            <div class="thumb-item group relative"
                onmouseenter="activateVideoPreview(this)"
                onmouseleave="deactivateVideoPreview(this)">
                <a href="${linkUrl}" target="_blank" rel="noopener" style="display:block;width:100%;height:100%;">
                    <img class="thumb-static" src="${thumbSrc}" alt="${badge}" style="width:100%;height:100%;object-fit:cover;transition:opacity 0.2s;">
                    ${videoEmbed}
                    <div class="thumb-play">
                        <span class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-lg shadow-lg">â–¶</span>
                    </div>
                </a>
                <span style="position:absolute;bottom:6px;left:6px;background:${badgeBg};color:white;font-size:10px;font-weight:700;padding:2px 7px;border-radius:6px;z-index:10;">${badge}</span>
                <button onclick="removeVideo(${i})"
                    class="absolute top-1.5 right-1.5 w-6 h-6 bg-red-500 text-white rounded-full text-xs font-black opacity-0 group-hover:opacity-100 flex items-center justify-center shadow transition-opacity z-10">âœ•</button>
            </div>`;
        }).join('');
    }

    // ===== ãƒ›ãƒãƒ¼å‹•ç”»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ =====
    function activateVideoPreview(el) {
        const iframe = el.querySelector('iframe.thumb-video');
        const img    = el.querySelector('img.thumb-static');
        if (!iframe) return;
        iframe.style.opacity = '1';
        if (img) img.style.opacity = '0';
    }

    function deactivateVideoPreview(el) {
        const iframe = el.querySelector('iframe.thumb-video');
        const img    = el.querySelector('img.thumb-static');
        if (!iframe) return;
        // iframeã‚’å†ç”Ÿæˆã™ã‚‹ã“ã¨ã§å‹•ç”»ã‚’åœæ­¢
        const clone = iframe.cloneNode(true);
        clone.style.opacity = '0';
        clone.src = iframe.src; // å†ãƒ­ãƒ¼ãƒ‰ã§åœæ­¢
        iframe.parentNode.replaceChild(clone, iframe);
        if (img) img.style.opacity = '1';
    }

    async function saveVideos() {
        hideMsg('videoStatus');
        showMsg('videoStatus','â³ ä¿å­˜ä¸­...','info');
        const { data: { user } } = await sb.auth.getUser();
        if (!user) { showMsg('videoStatus','âŒ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã¦ã„ã¾ã™','error'); return; }
        const { error } = await sb.from('editors').upsert({
            id: user.id,
            sample_videos: videoList,
        }, { onConflict: 'id' });
        if (error) { showMsg('videoStatus','âŒ '+error.message,'error'); return; }
        showMsg('videoStatus','âœ… ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼','success');
        setTimeout(() => hideMsg('videoStatus'), 3000);
    }

    // ===== ãƒãƒ£ãƒƒãƒˆ =====
    let currentUserId   = null;
    let currentUserName = null;
    let chatPartnerId   = null;
    let chatSubscription = null;

    async function initChat() {
        const { data: { user } } = await sb.auth.getUser();
        if (!user) return;
        currentUserId = user.id;

        document.getElementById('chatOnlineStatus').textContent = 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³';

        // ç›¸æ‰‹ä¸€è¦§ï¼ˆeditorsãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰è‡ªåˆ†ä»¥å¤–ï¼‰
        const { data: editors } = await sb.from('editors').select('id, name').filter('id::text', 'neq', user.id);
        const select = document.getElementById('chatPartnerSelect');
        select.innerHTML = '<option value="">ç›¸æ‰‹ã‚’é¸æŠ...</option>';
        (editors || []).forEach(e => {
            const opt = document.createElement('option');
            opt.value = e.id;
            opt.textContent = e.name || e.id.slice(0, 8);
            select.appendChild(opt);
        });

        // è‡ªåˆ†ã®åå‰å–å¾—
        const { data: me } = await sb.from('editors').select('name').filter('id::text', 'eq', user.id).maybeSingle();
        currentUserName = me?.name || 'ã‚ãªãŸ';
    }

    async function selectChatPartner(partnerId) {
        chatPartnerId = partnerId;
        if (!partnerId) {
            document.getElementById('chatMessages').innerHTML = `
                <div class="text-center py-16 text-slate-300">
                    <div class="text-4xl mb-3">ğŸ’¬</div>
                    <p class="text-sm font-bold">ãƒãƒ£ãƒƒãƒˆç›¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                </div>`;
            return;
        }

        // æ—¢å­˜ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è³¼èª­ã‚’è§£é™¤
        if (chatSubscription) { chatSubscription.unsubscribe(); chatSubscription = null; }

        await loadMessages();

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è³¼èª­
        chatSubscription = sb.channel('messages-' + [currentUserId, partnerId].sort().join('-'))
            .on('postgres_changes', {
                event: 'INSERT', schema: 'public', table: 'messages',
            }, payload => {
                const msg = payload.new;
                const isMe = msg.sender_id === currentUserId || msg.sender_id.toString() === currentUserId.toString();
                if (
                    (msg.sender_id === currentUserId   && msg.receiver_id === chatPartnerId) ||
                    (msg.sender_id === chatPartnerId   && msg.receiver_id === currentUserId) ||
                    (msg.sender_id.toString() === currentUserId.toString() && msg.receiver_id.toString() === chatPartnerId.toString()) ||
                    (msg.sender_id.toString() === chatPartnerId.toString() && msg.receiver_id.toString() === currentUserId.toString())
                ) {
                    appendMessage(msg, isMe);
                }
            })
            .subscribe();
    }

    async function loadMessages() {
        const { data: msgs } = await sb.from('messages')
            .select('*')
            .or(`and(sender_id.eq.${currentUserId},receiver_id.eq.${chatPartnerId}),and(sender_id.eq.${chatPartnerId},receiver_id.eq.${currentUserId})`)
            .order('created_at', { ascending: true });

        const container = document.getElementById('chatMessages');
        container.innerHTML = '';

        if (!msgs || msgs.length === 0) {
            container.innerHTML = `
                <div class="text-center py-10 text-slate-300">
                    <div class="text-3xl mb-2">âœ‰ï¸</div>
                    <p class="text-sm font-bold">ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“</p>
                    <p class="text-xs mt-1">æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
                </div>`;
            return;
        }

        let lastDate = '';
        msgs.forEach(msg => {
            const isMe = msg.sender_id.toString() === currentUserId.toString();
            const msgDate = new Date(msg.created_at).toLocaleDateString('ja-JP', { month: 'long', day: 'numeric' });
            if (msgDate !== lastDate) {
                const div = document.createElement('div');
                div.className = 'chat-date-divider';
                div.textContent = msgDate;
                container.appendChild(div);
                lastDate = msgDate;
            }
            appendMessage(msg, isMe, false);
        });
        scrollChatBottom();
    }

    function appendMessage(msg, isMe, doScroll = true) {
        const container = document.getElementById('chatMessages');
        // ç©ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤ºã‚’å‰Šé™¤
        const empty = container.querySelector('.text-center');
        if (empty) empty.remove();

        const time = new Date(msg.created_at).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
        const avatarSrc = isMe
            ? (document.getElementById('avatarImg').src || '')
            : `https://api.dicebear.com/7.x/avataaars/svg?seed=${msg.sender_id}`;

        const wrap = document.createElement('div');
        wrap.className = 'chat-bubble-wrap';
        wrap.innerHTML = `
            <div class="chat-row ${isMe ? 'me' : ''}">
                <img src="${avatarSrc}" class="chat-avatar-sm" alt="avatar">
                <div>
                    <div class="chat-bubble ${isMe ? 'me' : 'them'}">${escapeHtml(msg.content)}</div>
                    <div class="chat-time ${isMe ? '' : 'them'}">${time}</div>
                </div>
            </div>`;
        container.appendChild(wrap);
        if (doScroll) scrollChatBottom();
    }

    async function sendMessage() {
        const input = document.getElementById('chatInput');
        const content = input.value.trim();
        if (!content || !chatPartnerId) return;

        input.value = '';
        input.style.height = 'auto';

        const { error } = await sb.from('messages').insert({
            sender_id:   currentUserId,
            receiver_id: chatPartnerId,
            content,
        });

        if (error) {
            console.error('send error:', error);
            alert('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸï¼š' + error.message);
        }
    }

    function scrollChatBottom() {
        const el = document.getElementById('chatMessages');
        el.scrollTop = el.scrollHeight;
    }

    function escapeHtml(str) {
        return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>');
    }

    // ===== ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ =====
    async function handleLogout() {
        await sb.auth.signOut();
        showAuth();
    }

    // ===== UIåˆ‡ã‚Šæ›¿ãˆ =====
    function showAuth() {
        document.getElementById('authSection').classList.remove('hidden');
        document.getElementById('mypageSection').classList.add('hidden');
    }
    function showMypage() {
        document.getElementById('authSection').classList.add('hidden');
        document.getElementById('mypageSection').classList.remove('hidden');
    }
</script>
</body>
</html>
