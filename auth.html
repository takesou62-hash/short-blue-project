<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shorts Match - ãƒ­ã‚°ã‚¤ãƒ³ / ãƒã‚¤ãƒšãƒ¼ã‚¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%); }
        .gradient-btn { background: linear-gradient(to right, #06b6d4, #3b82f6); }
        .fade-in { animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="gradient-bg min-h-screen">

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <div class="max-w-5xl mx-auto px-6 py-4 flex items-center justify-between">
            <a href="index.html" class="flex items-center gap-2 font-bold text-xl text-cyan-600">â–¶ Shorts Match</a>
            <a href="index.html" class="text-sm font-bold text-slate-500 hover:text-cyan-600">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸</a>
        </div>
    </header>

    <main class="max-w-md mx-auto px-6 py-12">
        <div id="authSection" class="fade-in">
            <div class="text-center mb-8">
                <div class="w-16 h-16 gradient-btn rounded-2xl flex items-center justify-center text-white text-2xl mx-auto mb-4 shadow-lg">âœï¸</div>
                <h1 class="text-3xl font-black text-slate-800 mb-2">ç·¨é›†è€…ãƒãƒ¼ã‚¿ãƒ«</h1>
                <p class="text-slate-500">ãƒ­ã‚°ã‚¤ãƒ³ã¾ãŸã¯æ–°è¦ç™»éŒ²ã‚’ã—ã¦ãã ã•ã„</p>
            </div>

            <div class="bg-white rounded-3xl shadow-xl p-8">
                <div class="flex rounded-2xl bg-slate-100 p-1 mb-8">
                    <button id="tabLogin" onclick="switchTab('login')" class="flex-1 py-2.5 rounded-xl font-bold text-sm transition-all bg-white text-slate-800 shadow-sm">ãƒ­ã‚°ã‚¤ãƒ³</button>
                    <button id="tabRegister" onclick="switchTab('register')" class="flex-1 py-2.5 rounded-xl font-bold text-sm transition-all text-slate-500">æ–°è¦ç™»éŒ²</button>
                </div>

                <div id="loginForm" class="space-y-5">
                    <input id="loginEmail" type="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50">
                    <input id="loginPassword" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50">
                    <div id="loginError" class="text-red-500 text-sm hidden font-bold"></div>
                    <button onclick="handleLogin()" class="w-full gradient-btn text-white py-4 rounded-2xl font-bold shadow-lg shadow-cyan-200 hover:scale-[1.02] transition-all">ãƒ­ã‚°ã‚¤ãƒ³</button>
                </div>

                <div id="registerForm" class="hidden space-y-5">
                    <input id="regName" type="text" placeholder="ãŠåå‰ï¼ˆè¡¨ç¤ºåï¼‰" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50">
                    <input id="regEmail" type="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50">
                    <input id="regPassword" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ6æ–‡å­—ä»¥ä¸Šï¼‰" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl outline-none focus:border-cyan-400 bg-slate-50">
                    <div id="registerError" class="text-red-500 text-sm hidden font-bold"></div>
                    <button onclick="handleRegister()" class="w-full gradient-btn text-white py-4 rounded-2xl font-bold shadow-lg shadow-cyan-200 hover:scale-[1.02] transition-all">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ</button>
                </div>
            </div>
        </div>

        <div id="mypageSection" class="hidden fade-in space-y-6">
            <div class="text-center">
                <div class="w-20 h-20 rounded-2xl mx-auto mb-4 bg-slate-100 flex items-center justify-center text-3xl shadow-lg border-4 border-white">ğŸ‘¤</div>
                <h1 class="text-2xl font-black text-slate-800" id="mypageName">èª­ã¿è¾¼ã¿ä¸­...</h1>
                <p class="text-cyan-600 font-bold text-sm" id="mypageEmail"></p>
            </div>

            <div class="bg-white rounded-3xl shadow-xl p-8 space-y-6">
                <h2 class="text-lg font-bold text-slate-800 border-b pb-4">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</h2>
                <div>
                    <label class="block text-xs font-bold text-slate-400 mb-2 px-1">è¡¨ç¤ºå</label>
                    <input type="text" id="mpName" class="w-full p-4 bg-slate-50 rounded-2xl border-2 border-transparent focus:border-cyan-400 outline-none transition-all">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 mb-2 px-1">å˜ä¾¡ç›®å®‰</label>
                    <input type="text" id="mpPrice" placeholder="ä¾‹: Â¥3,000ã€œ" class="w-full p-4 bg-slate-50 rounded-2xl border-2 border-transparent focus:border-cyan-400 outline-none transition-all">
                </div>
                <div id="mypageStatus" class="text-center font-bold text-sm hidden"></div>
                <button onclick="handleUpdate()" class="w-full gradient-btn text-white py-4 rounded-2xl font-bold shadow-lg shadow-cyan-200 hover:scale-[1.02] transition-all">ä¿å­˜ã™ã‚‹</button>
            </div>
            <button onclick="handleLogout()" class="w-full bg-white text-slate-400 py-4 rounded-2xl font-bold border-2 border-slate-100 hover:text-red-500 transition-all">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
    </main>

   <script>
        const SUPABASE_URL = 'https://dwmgwdhunvanrsautvtj.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_GzaEGCWBP7y0za2UVPiJNA_N3pdlgJ0';
        const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // çŠ¶æ…‹ç›£è¦–ï¼šãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
        sb.auth.onAuthStateChanged((event, session) => {
            if (session) { loadMypage(session.user); } else { showAuth(); }
        });

        // ãƒ­ã‚°ã‚¤ãƒ³ã¨æ–°è¦ç™»éŒ²ã®è¦‹ãŸç›®ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
        function switchTab(tab) {
            const isLogin = tab === 'login';
            document.getElementById('loginForm').classList.toggle('hidden', !isLogin);
            document.getElementById('registerForm').classList.toggle('hidden', isLogin);
            document.getElementById('tabLogin').className = isLogin ? 'flex-1 py-2.5 rounded-xl font-bold text-sm bg-white text-slate-800 shadow-sm' : 'flex-1 py-2.5 rounded-xl font-bold text-sm text-slate-500';
            document.getElementById('tabRegister').className = !isLogin ? 'flex-1 py-2.5 rounded-xl font-bold text-sm bg-white text-slate-800 shadow-sm' : 'flex-1 py-2.5 rounded-xl font-bold text-sm text-slate-500';
        }

        // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errEl = document.getElementById('loginError');
            errEl.classList.add('hidden');

            const { data, error } = await sb.auth.signInWithPassword({ email, password });
            if (error) { errEl.textContent = 'âŒ ' + error.message; errEl.classList.remove('hidden'); }
        }

        // æ–°è¦ç™»éŒ²å‡¦ç†
        async function handleRegister() {
            const email = document.getElementById('regEmail').value.trim();
            const password = document.getElementById('regPassword').value;
            const name = document.getElementById('regName').value.trim();
            const errEl = document.getElementById('registerError');
            errEl.classList.add('hidden');
            
            if (!name) { errEl.textContent = 'âš ï¸ ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'; errEl.classList.remove('hidden'); return; }

            const { data, error } = await sb.auth.signUp({ email, password });
            if (error) { errEl.textContent = 'âŒ ' + error.message; errEl.classList.remove('hidden'); } 
            else if (data.user) {
                // ç™»éŒ²ã¨åŒæ™‚ã«åå‰ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
                await sb.from('editors').upsert({ id: data.user.id, name: name });
                alert('ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
            }
        }

        // ãƒã‚¤ãƒšãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
        async function loadMypage(user) {
            showMypage();
            document.getElementById('mypageEmail').textContent = user.email;
            const { data } = await sb.from('editors').select('*').filter('id::text', 'eq', user.id).maybeSingle();
            if (data) {
                document.getElementById('mypageName').textContent = data.name || 'æœªè¨­å®š';
                document.getElementById('mpName').value = data.name || '';
                document.getElementById('mpPrice').value = data.price || '';
            }
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä¿å­˜ã™ã‚‹
        async function handleUpdate() {
            const statusEl = document.getElementById('mypageStatus');
            statusEl.className = 'text-center font-bold text-sm text-cyan-600';
            statusEl.textContent = 'ä¿å­˜ä¸­...';
            statusEl.classList.remove('hidden');

            const { data: { user } } = await sb.auth.getUser();
            const updates = {
                id: user.id,
                name: document.getElementById('mpName').value.trim(),
                price: document.getElementById('mpPrice').value.trim()
            };

            const { error } = await sb.from('editors').upsert(updates, { onConflict: 'id' });
            if (error) {
                statusEl.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message;
                statusEl.classList.add('text-red-500');
            } else {
                statusEl.textContent = 'âœ… ä¿å­˜ã—ã¾ã—ãŸï¼';
                statusEl.classList.add('text-emerald-500');
                document.getElementById('mypageName').textContent = updates.name;
                setTimeout(() => statusEl.classList.add('hidden'), 3000);
            }
        }

        async function handleLogout() { await sb.auth.signOut(); }
        function showAuth() { document.getElementById('authSection').classList.remove('hidden'); document.getElementById('mypageSection').classList.add('hidden'); }
        function showMypage() { document.getElementById('authSection').classList.add('hidden'); document.getElementById('mypageSection').classList.remove('hidden'); }
    </script>
</body>
</html>
